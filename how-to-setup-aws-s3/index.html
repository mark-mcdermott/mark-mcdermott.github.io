<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.13.2"><title>Mark McDermott</title><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.DZnDNxNb.js"></script><link rel="stylesheet" href="/_astro/_slug_.B_QYcVCA.css">
<style>footer[data-astro-cid-olvf4l2g]{display:flex;flex-flow:column wrap;align-content:flex-end}.markdown{line-height:28px;--path: none;--radius-top: 12px;--radius-bottom: 12px;--padding-top: 1rem;--padding-bottom: 1rem}.markdown p{padding-bottom:2rem}.markdown a{border-bottom-width:1px;border-color:var(--link);color:var(--link)}.markdown hr{padding-top:2rem;opacity:.6}@media (prefers-color-scheme: dark){.markdown hr{opacity:.1}}.markdown h1{margin-top:.5rem;padding-bottom:2rem;font-family:Montserrat;font-size:2.25rem;line-height:2.5rem;font-weight:700}.markdown h2{margin-top:.5rem;padding-bottom:2rem;font-family:Montserrat;font-size:1.875rem;line-height:2.25rem;font-weight:700}.markdown h3{margin-top:.5rem;padding-bottom:2rem;font-size:1.5rem;line-height:2rem;font-weight:700}.markdown h4{margin-top:.5rem;padding-bottom:2rem;font-size:1.25rem;line-height:1.75rem;font-weight:700}.markdown :not(pre)>code{background:var(--inlineCode-bg);color:var(--inlineCode-text);padding:.15em .2em .05em;white-space:normal}.markdown pre{margin-left:-1rem;margin-right:-1rem;margin-bottom:2rem;overflow-y:auto;padding:1rem;font-size:.875rem;line-height:1.25rem;clip-path:var(--path);border-top-right-radius:var(--radius-top);border-top-left-radius:var(--radius-top);border-bottom-right-radius:var(--radius-bottom);border-bottom-left-radius:var(--radius-bottom);padding-top:var(--padding-top);padding-bottom:var(--padding-bottom)}.markdown pre code{width:auto}.markdown blockquote{position:relative;left:-.5rem;margin-left:-1rem;margin-bottom:2rem;padding-left:1rem;font-style:italic;border-left:3px solid hsla(0,0%,0%,.9);border-left-color:inherit;opacity:.8}.markdown blockquote p{margin:0;padding:0}.markdown p img{margin-bottom:0}.markdown ul{margin-top:0;padding:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc}.markdown li{margin-bottom:.875rem}.markdown img{margin-bottom:2rem;max-width:100%}.markdown pre [data-highlighted-line]{margin-left:-16px;padding-left:12px;border-left:4px solid #ffa7c4;background-color:#022a4b;display:block;padding-right:1em}
</style>
<link rel="stylesheet" href="/_astro/index.CX5Zbgb8.css"></head> <body class="mx-auto max-w-7xl bg-[--bg] px-5 py-12 text-[--text]">   <header class="mb-14 flex flex-row place-content-between"> <a class="inline-block text-2xl font-black font-['Montserrat'] hover:scale-[1.02]" target="_self" href="/"><span>markmcdermott.io (js,&nbsp;ruby,&nbsp;...etc)</span> </a> <span class="min-w-20 relative top-[4px] italic">
by
<a class="scale-100 active:scale-100" target="_blank" href="https://github.com/mark-mcdermott"><img src="https://avatars.githubusercontent.com/u/9694783?v=5" alt="mark mcdermott" title="mark mcdermott" loading="lazy" decoding="async" fetchpriority="auto" width="32" height="32" class="relative -top-1 mx-2 inline h-8 w-8 rounded-full"> </a> </span> </header>  <article> <h1 class="text-[40px] font-black leading-[44px] text-[--title] font-['Montserrat']" style="--myColor1:var(--pink);--myColor2:var(--purple);background-image:linear-gradient(45deg, var(--myColor1), var(--myColor2));background-clip:text;-webkit-background-clip:text;color:transparent;transition:--myColor1 0.2s ease-out, --myColor2 0.2s ease-in-out"> AWS S3 </h1> <div class="mt-1 post-subtitle" style="color: var(--purple)"><p>How to setup AWS S3</p></div> <p class="mb-6 mt-2 text-[13px] text-gray-700 dark:text-gray-300"> 07/31/2024 </p> <p class="mt-2 text-[13px] text-gray-700 dark:text-gray-300">
read time：6 mins </p> <div class="markdown mt-10"> <h3 id="aws-s3-setup">AWS S3 Setup</h3>
<p>Let’s create an AWS S3 account so we can store user avatar images there as well as any other file uploads we might need. There are a few parts here. We want to create a S3 bucket to store the files. But a S3 bucket needs a IAM user. Both the S3 bucket and the IAM user need permissions policies. There’s a little bit of a chicken and egg issue here - when we create the user permissions policy, we need the S3 bucket name. But when we create the S3 bucket permissions, we need the IAM user name. So we’ll create everything and use placeholder strings in some of the policies. Then when we’re all done, we’ll go through the policies and update all the placeholder strings to what they really need to be.</p>
<h4 id="aws-general-setup">AWS General Setup</h4>
<ul>
<li>login to AWS (<a href="https://aws.amazon.com">https://aws.amazon.com</a>)
<ul>
<li>If you don’t have an AWS account, you’ll need to sign up. It’s been awhile since I did this part - I think you have to create a root user and add you credit card or something. Google it if you run into trouble with this part.</li>
</ul>
</li>
<li>at top right, select a region if currently says <code>global</code> (I use the <code>us-east-1</code> region). If all the region options are grayed out, ignore this for now and we’ll set it later.</li>
<li>at top right click your name
<ul>
<li>next to Account ID, click the copy icon (two overlapping squares)</li>
<li>make an <code>app</code> folder: <code>mkdir ~/app</code></li>
<li>create a <code>.secrets</code> file: <code>touch ~/app/.secrets</code></li>
<li>paste your Account ID in your <code>~/app/.secrets</code> file (It pastes without the dashes. Leave it that way - you need it without the dashes.)</li>
</ul>
</li>
</ul>
<h4 id="aws-user-policy">AWS User Policy</h4>
<ul>
<li>in searchbar at top, enter <code>iam</code> and select IAM</li>
<li>click <code>Policies</code> in the left sidebar under Access Managment
<ul>
<li>click <code>Create policy</code> towards the top right</li>
<li>click the <code>JSON</code> tab on Policy Editor</li>
<li>under Policy Editor select all with <code>command + a</code> and then hit <code>delete</code> to clear out everything there</li>
<li>enter this under Policy Editor (we’ll update it shortly, once we have our user and bucket names):</li>
</ul>
</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">	&quot;Version&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;2012-10-17&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">	&quot;Statement&quot;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#E1E4E8">		{</span></span>
<span class="line"><span style="color:#79B8FF">			&quot;Sid&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;AllowGetObject&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">			&quot;Effect&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;Allow&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">			 &quot;Action&quot;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">          &quot;s3:PutObject&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          &quot;s3:GetObject&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          &quot;s3:DeleteObject&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            ],</span></span>
<span class="line"><span style="color:#79B8FF">			&quot;Resource&quot;</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">&quot;arn:aws:s3:::&lt;development bucket name&gt;&quot;</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">&quot;arn:aws:s3:::&lt;production bucket name&gt;&quot;</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"><span style="color:#E1E4E8">	]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<ul>
<li>click Next towards bottom right</li>
<li>for Policy Name, enter <code>app-s3-user-policy</code></li>
<li>paste your policy name in your <code>.secrets</code> file</li>
<li>click Create Policy towards the bottom right</li>
</ul>
<h4 id="aws-user">AWS User</h4>
<ul>
<li>click <code>Users</code> under Access Management in the left sidebar
<ul>
<li>click <code>Create User</code> towards the top right</li>
<li>enter name, something like <code>app-s3-user</code> (add this to your <code>.secrets</code> file - you’ll need it later)</li>
<li>click Next</li>
<li>under Permissions Options click <code>Attach policies directly</code></li>
<li>in the search bar under Permissions Policies, enter <code>app-s3-user-policy</code> -&gt; this should then show the policy we just created above (<code>app-s3-user-policy</code>) under Policy Name</li>
<li>under Policy Name, click the checkbox to the left of <code>app-s3-user-policy</code></li>
<li>click Next</li>
<li>click Create User towards the bottom right</li>
</ul>
</li>
<li>under Users, click the name of the user we just created (<code>app-user</code>)
<ul>
<li>click Security Credentials tab</li>
<li>click <code>Create Access key</code> towards the top right
<ul>
<li>Use case: <code>Local code</code></li>
<li>check <code>I understand the above recommendation</code></li>
<li>Next</li>
<li>Description tag value: enter tag name, like <code>app-user-access-key</code></li>
<li>click <code>Create access key</code> towards the bottom right</li>
<li>paste both the Access Key and the Secret Access Key into your <code>.secrets</code> file - this is important!</li>
<li>click Done</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="aws-s3-bucket">AWS S3 Bucket</h4>
<ul>
<li>in searchbar at top, enter <code>s3</code> and select S3</li>
<li>Create Bucket
<ul>
<li>for Bucket Name, enter something like <code>app-s3-bucket-development</code> (below when you click Create Bucket, it may tell you this bucket already exists and you will have to make it more unique. Regardless, add this to your <code>.secrets</code> file - you’ll need it later. Also, make sure it ends in <code>-development</code>.)</li>
<li>under Object Ownership, click ACLs Enabled</li>
<li>under Block Public Access settings
<ul>
<li>uncheck the first option, <code>Block All Public Access</code></li>
<li>check the last two options, <code>Block public access to buckets and objects granted through new public bucket or access point policies</code> and <code>Block public and cross-account access to buckets and objects through any public bucket or access point policies</code></li>
</ul>
</li>
<li>check <code>I acknowledge that the current settings might result in this bucket and the objects within becoming public.</code></li>
<li>scroll to bottom and click Create Bucket (if nothing happens, scroll up and look for red error messages)</li>
</ul>
</li>
<li>under General Purpose Buckets, click the name of the bucket you just created -&gt; then click the Permissions tab towards the top
<ul>
<li>in the Bucket Policy section, click Edit (to the right of “Bucket Policy”)</li>
<li>copy/paste the boilerplate json bucket policy in the next line below this into the text editor area under Policy.</li>
<li>here is the boilerplate json bucket policy:</li>
</ul>
</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">    &quot;Version&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;2012-10-17&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">    &quot;Statement&quot;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#79B8FF">            &quot;Effect&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;Allow&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">            &quot;Principal&quot;</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">                &quot;AWS&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;arn:aws:iam::&lt;aws acct id without dashes&gt;:user/&lt;iam username&gt;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#79B8FF">            &quot;Action&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;s3:ListBucket&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">            &quot;Resource&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;arn:aws:s3:::&lt;bucket name&gt;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#79B8FF">            &quot;Effect&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;Allow&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">            &quot;Principal&quot;</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">                &quot;AWS&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;arn:aws:iam::&lt;aws acct id without dashes&gt;:user/&lt;iam username&gt;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#79B8FF">            &quot;Action&quot;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">                &quot;s3:GetObject&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">                &quot;s3:PutObject&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">                &quot;s3:DeleteObject&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">            ],</span></span>
<span class="line"><span style="color:#79B8FF">            &quot;Resource&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;arn:aws:s3:::&lt;bucket name&gt;/*&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<ul>
<li>Update all the <code>&lt;aws acct id without dashes&gt;</code>, <code>&lt;iam username&gt;</code> and <code>&lt;bucket name&gt;</code> parts in the policy now in the text editor area under Policy with the account number, user name and bucket name you jotted down above in your <code>~/app/.secrets</code> file.</li>
<li>click Save Changes towards the bottom right</li>
<li>in the Cross-Origin Resource Sharing (CORS) section, click <code>Edit</code> (to the right of “Cross-origin resource sharing (CORS)”)</li>
<li>under Cross-origin Resource Sharing (CORS) add this:</li>
</ul>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#E1E4E8">[</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;AllowedHeaders&quot;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">            &quot;*&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;AllowedMethods&quot;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">            &quot;GET&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            &quot;POST&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            &quot;PUT&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">            &quot;DELETE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;AllowedOrigins&quot;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">            &quot;*&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;ExposeHeaders&quot;</span><span style="color:#E1E4E8">: [],</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;MaxAgeSeconds&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">3000</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">]</span></span></code></pre>
<ul>
<li>click Save Changes towards the bottom right</li>
<li>now repeat this entire “AWS S3 Bucket” step above again, but make a production s3 bucket named something like <code>app-s3-bucket-production</code> and note the production bucket name in your <code>.secrets</code> file</li>
<li>now that we know our bucket names, let’s update the our user policy with the bucket name
<ul>
<li>in the searchbar at the top of the page, type <code>iam</code> and select <code>IAM</code></li>
<li>click <code>Policies</code> in the left sidebar under Access Management</li>
<li>in the searchbar under Policies, type <code>app-s3-user-policy</code> -&gt; click <code>app-s3-user-policy</code> under Policy Name</li>
<li>click Edit towards the top right</li>
<li>in the Policy Editor text editor area, change the line <code>&quot;Resource&quot;: [&quot;arn:aws:s3:::&lt;development bucket name&gt;&quot;, &quot;arn:aws:s3:::&lt;production bucket name&gt;&quot;]</code> replace <code>&lt;development bucket name&gt;</code> and <code>&lt;production bucket name&gt;</code> with your development bucket name and production bucket name, respectively, in your <code>.secrets</code> file</li>
<li>click Next towards the bottom right</li>
<li>click Save Changes towards the bottom right</li>
</ul>
</li>
<li>see what region you’re logged into
<ul>
<li>click the AWS logo in the top left</li>
<li>in the top right there will be a region dropdown - click it</li>
<li>look at the highlighted region in the dropdown and look for the region string to the right of it - something like <code>us-east-1</code></li>
<li>paste your region string in your <code>~/app/.secrets</code> file in the <code>aws region</code> line</li>
</ul>
</li>
</ul> <!-- @ts-expect-error: Custom attributes for Utterances script --> <script src="https://utteranc.es/client.js" repo="mark-mcdermott/mark-mcdermott.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script> </div> </article> <footer class="mt-12" data-astro-cid-olvf4l2g> <a class="inline-block text-2xl font-black font-['Montserrat'] hover:scale-[1.02]" target="_self" href="/"><span data-astro-cid-i45duxs4>markmcdermott.io</span> </a> <p data-astro-cid-i45duxs4> <a href="https://github.com/mark-mcdermott" data-astro-cid-i45duxs4>github</a> |
<a href="https://bsky.app/profile/mark-mcdermott.bsky.social" data-astro-cid-i45duxs4>bluesky</a> |
<a href="https://www.linkedin.com/in/mark-mcdermott-6a174916/" data-astro-cid-i45duxs4>linkedin</a></p> <p data-astro-cid-i45duxs4>&copy; 2025 mark mcdermott </p>  </footer>  </body></html> 